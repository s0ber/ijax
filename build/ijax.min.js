/*! ijax (v0.1.0),
 ,
 by Sergey Shishkalov <sergeyshishkalov@gmail.com>
 Tue Sep 16 2014 */
(function(){var e;e={},null==window.modula&&(window.modula={"export":function(t,o){return e[t]=o},require:function(t){var o;if(o=e[t])return o;throw"Module '"+t+"' not found."}})}).call(this),function(){window.Ijax=function(){function e(){this.IjaxRequest=modula.require("ijax/request"),this.requests={}}return e.prototype.get=function(e){var t;return this.abortCurrentRequest(),this.curRequest=t=new this.IjaxRequest(e),this.requests[t.id]=t,t},e.prototype.abortCurrentRequest=function(){var e,t,o;if(null!=this.curRequest)return e=!this.curRequest.isResolved,t=!(null!=(o=this.curRequest.response)?o.isResolved:void 0),!e&&!t||this.curRequest.isRejected?void 0:(this.curRequest.reject(),this.removeRequest(this.curRequest))},e.prototype.removeRequest=function(e){return delete this.requests[e.id],delete this.curRequest},e.prototype.registerResponse=function(){return this.curRequest.registerResponse(),this.curRequest.resolve()},e.prototype.resolveResponse=function(){return this.curRequest.response.resolve(),this.removeRequest(this.curRequest)},e.prototype.pushLayout=function(e){return this.curRequest.response.addLayout(e)},e.prototype.pushFrame=function(e,t){return this.curRequest.response.addFrame(e,t)},e}(),modula["export"]("ijax",Ijax)}.call(this),function(){var e;e=function(){function e(){this.isResolved=!1}return e.prototype.onResolve=function(e){return this.onResolveCallback=e,this},e.prototype.onLayoutReceive=function(e){return this.onLayoutReceiveCallback=e,this},e.prototype.onFrameReceive=function(e){return this.onFrameReceiveCallback=e,this},e.prototype.resolve=function(){return this.isResolved=!0,"function"==typeof this.onResolveCallback?this.onResolveCallback():void 0},e.prototype.addLayout=function(e){return"function"==typeof this.onLayoutReceiveCallback?this.onLayoutReceiveCallback(e):void 0},e.prototype.addFrame=function(e,t){return"function"==typeof this.onFrameReceiveCallback?this.onFrameReceiveCallback(e,t):void 0},e}(),modula["export"]("ijax/response",e)}.call(this),function(){var e,t={}.hasOwnProperty;e=function(){function e(e){this.id=this._getGuid(),this.path=this._updatePathParams(e,{format:"al",i_req_id:this.id,full_page:!0}),this.isResolved=!1,this.isRejected=!1,this.iframe=this.createIframeRequest(),this.iframe.onload=_.bind(this.updateIframeStatus,this)}return e.prototype.IjaxResponse=modula.require("ijax/response"),e.prototype.createIframeRequest=function(e){var t,o,r;return null==e&&(e=!0),o=this.path||"javascript:false",r=document.createElement("div"),r.innerHTML='<iframe name="'+this.id+'" id="'+this.id+'" src="'+o+'">',t=r.firstChild,t.style.display="none",e&&document.body.appendChild(t),t},e.prototype.registerResponse=function(){return this.response=new this.IjaxResponse},e.prototype.done=function(e){return this.onDoneCallback=e,this},e.prototype.fail=function(e){return this.onFailCallback=e,this},e.prototype.resolve=function(){return this.isResolved=!0,"function"==typeof this.onDoneCallback?this.onDoneCallback(this.response):void 0},e.prototype.reject=function(){return this.isRejected=!0,"function"==typeof this.onFailCallback&&this.onFailCallback(),this.removeIframe()},e.prototype.updateIframeStatus=function(){return this.removeIframe(),this.isResolved?void 0:this.showError()},e.prototype.showError=function(){},e.prototype.removeIframe=function(){var e;return null!=(e=this.iframe.parentNode)?e.removeChild(this.iframe):void 0},e.prototype._getGuid=function(){return this._s4()+this._s4()+"-"+this._s4()+"-"+this._s4()+"-"+this._s4()+"-"+this._s4()+this._s4()+this._s4()},e.prototype._s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e.prototype._updatePathParams=function(e,o){var r,i,s,n;for(r in o)t.call(o,r)&&(n=o[r],i=new RegExp("([?|&])"+r+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?",e=i.test(e)?e.replace(i,"$1"+r+"="+n+"$2"):e+s+r+"="+n);return e},e}(),modula["export"]("ijax/request",e)}.call(this);