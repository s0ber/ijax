/*! ijax (v0.1.2),
 ,
 by Sergey Shishkalov <sergeyshishkalov@gmail.com>
 Mon Nov 10 2014 */
(function(){var e;e={},null==window.modula&&(window.modula={"export":function(t,o){return e[t]=o},require:function(t){var o;if(o=e[t])return o;throw"Module '"+t+"' not found."}})}).call(this),function(){var e;e=function(){function e(){}return e.prototype.onResponseResolve=function(){},e.prototype.onResponseFail=function(){},e}(),modula["export"]("ijax/configuration",e)}.call(this),function(){window.Ijax=function(){function e(){this.IjaxRequest=modula.require("ijax/request"),this.requests={}}var t;return t=modula.require("ijax/configuration"),e.config=function(){return null!=this._config?this._config:this._config=new t},e.configure=function(e){return _.extend(this.config(),e)},e.prototype.get=function(e){var t;return this.abortCurrentRequest(),this.curRequest=t=new this.IjaxRequest(e),this.requests[t.id]=t,t},e.prototype.abortCurrentRequest=function(){var e,t,o;if(null!=this.curRequest)return e=!this.curRequest.isResolved,t=!(null!=(o=this.curRequest.response)?o.isResolved:void 0),!e&&!t||this.curRequest.isRejected?void 0:(this.curRequest.reject(),this.removeRequest(this.curRequest))},e.prototype.removeRequest=function(e){return delete this.requests[e.id],delete this.curRequest},e.prototype.registerResponse=function(e,t){return this.curRequest.registerResponse(t),this.curRequest.resolve()},e.prototype.resolveResponse=function(){return this.curRequest.response.resolve(),this.removeRequest(this.curRequest)},e.prototype.pushLayout=function(e){return this.curRequest.response.addLayout(e)},e.prototype.pushFrame=function(e,t){return this.curRequest.response.addFrame(e,t)},e}(),modula["export"]("ijax",Ijax)}.call(this),function(){var e;e=function(){function e(e){this.options=e,this.isResolved=!1}return e.prototype.onResolve=function(e){return this.onResolveCallback=e,this},e.prototype.onLayoutReceive=function(e){return this.onLayoutReceiveCallback=e,this},e.prototype.onFrameReceive=function(e){return this.onFrameReceiveCallback=e,this},e.prototype.resolve=function(){return this.isResolved=!0,Ijax.config().onResponseResolve(this,this.options)!==!1?"function"==typeof this.onResolveCallback?this.onResolveCallback(this.options):void 0:void 0},e.prototype.addLayout=function(e){return"function"==typeof this.onLayoutReceiveCallback?this.onLayoutReceiveCallback(e):void 0},e.prototype.addFrame=function(e,t){return"function"==typeof this.onFrameReceiveCallback?this.onFrameReceiveCallback(e,t):void 0},e}(),modula["export"]("ijax/response",e)}.call(this),function(){var e,t={}.hasOwnProperty;e=function(){function e(e){this.id=this._getGuid(),this.path=e,this.iframePath=this._updatePathParams(e,{format:"al",i_req_id:this.id,full_page:!0}),this.isResolved=!1,this.isRejected=!1,this.iframe=this.createIframeRequest(),this.iframe.onload=_.bind(this.updateIframeStatus,this)}return e.prototype.IjaxResponse=modula.require("ijax/response"),e.prototype.createIframeRequest=function(e){var t,o,i;return null==e&&(e=!0),o=this.iframePath||"javascript:false",i=document.createElement("div"),i.innerHTML='<iframe name="'+this.id+'" id="'+this.id+'" src="'+o+'">',t=i.firstChild,t.style.display="none",e&&document.body.appendChild(t),t},e.prototype.registerResponse=function(e){return e=_.extend({path:this.path},e),this.response=new this.IjaxResponse(e)},e.prototype.done=function(e){return this.onDoneCallback=e,this},e.prototype.fail=function(e){return this.onFailCallback=e,this},e.prototype.resolve=function(){return this.isResolved=!0,"function"==typeof this.onDoneCallback?this.onDoneCallback(this.response):void 0},e.prototype.reject=function(){return this.isRejected=!0,"function"==typeof this.onFailCallback&&this.onFailCallback(),this.removeIframe()},e.prototype.updateIframeStatus=function(){return this.removeIframe(),this.isResolved?void 0:this.showError()},e.prototype.showError=function(){},e.prototype.removeIframe=function(){var e;return null!=(e=this.iframe.parentNode)?e.removeChild(this.iframe):void 0},e.prototype._getGuid=function(){return this._s4()+this._s4()+"-"+this._s4()+"-"+this._s4()+"-"+this._s4()+"-"+this._s4()+this._s4()+this._s4()},e.prototype._s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e.prototype._updatePathParams=function(e,o){var i,n,r,s;for(i in o)t.call(o,i)&&(s=o[i],n=new RegExp("([?|&])"+i+"=.*?(&|$)","i"),r=-1!==e.indexOf("?")?"&":"?",e=n.test(e)?e.replace(n,"$1"+i+"="+s+"$2"):e+r+i+"="+s);return e},e}(),modula["export"]("ijax/request",e)}.call(this);